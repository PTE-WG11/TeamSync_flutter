æ ¹æ®æ‚¨çš„ç¡®è®¤ï¼Œæˆ‘ç°åœ¨ä¸ºæ‚¨ç”Ÿæˆå®Œæ•´çš„ **PRDéœ€æ±‚åˆ†ææ–‡æ¡£**ã€‚

---

# ğŸ“‹ é¡¹ç›®éœ€æ±‚æ–‡æ¡£ (PRD)
**é¡¹ç›®åç§°**ï¼šTeamSync å›¢é˜Ÿåä½œç®¡ç†ç³»ç»Ÿ  
**ç‰ˆæœ¬**ï¼šv1.0  
**æŠ€æœ¯æ ˆ**ï¼šDRF + JWT + MySQL 8 + Django Channels + Flutter + MinIO  
**æ—¥æœŸ**ï¼š2026-02-09

---

## 1. æ–‡æ¡£æ¦‚è¿°

### 1.1 é¡¹ç›®èƒŒæ™¯
é¢å‘è½¯ä»¶å…¬å¸å°å›¢é˜Ÿçš„è½»é‡çº§é¡¹ç›®ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒé¡¹ç›®-ä»»åŠ¡å¤šçº§åˆ†è§£ã€å¯è§†åŒ–è¿›åº¦è¿½è¸ªï¼ˆçœ‹æ¿/ç”˜ç‰¹å›¾/æ—¥å†ï¼‰ã€ç²¾ç»†åŒ–æƒé™æ§åˆ¶ã€‚

### 1.2 æ ¸å¿ƒè®¾è®¡åŸåˆ™
- **æ•°æ®éš”ç¦»**ï¼šæˆå‘˜å¯è§é¡¹ç›®å…¨è²Œï¼Œä½†ä»»åŠ¡è¯¦æƒ…æŒ‰æƒé™è„±æ•
- **è¿›åº¦èšåˆ**ï¼šé¡¹ç›®çº§è¿›åº¦åªç»Ÿè®¡ä¸»ä»»åŠ¡ï¼Œå­ä»»åŠ¡ä¸ºä¸ªäººå·¥ä½œåˆ†è§£
- **å®¡è®¡è¿½è¸ª**ï¼šæ‰€æœ‰çŠ¶æ€å˜æ›´è®°å½•å†å²ï¼Œé€¾æœŸçŠ¶æ€ä¿ç•™è‡³å½’æ¡£
- **ä¸å¯åˆ é™¤**ï¼šé¡¹ç›®åˆ›å»ºåä»…å¯å½’æ¡£ï¼Œé˜²æ­¢è¯¯æ“ä½œæ•°æ®ä¸¢å¤±

---

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 åŠŸèƒ½æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         è¡¨ç°å±‚ (Flutter)                      â”‚
â”‚  Webç«¯                    ç§»åŠ¨ç«¯                  æ¡Œé¢ç«¯      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    APIç½‘å…³ (DRF + JWT)                        â”‚
â”‚   â€¢ è®¤è¯ä¸­é—´ä»¶ï¼ˆAccess/Refresh Tokenï¼‰                        â”‚
â”‚   â€¢ æƒé™æ ¡éªŒï¼ˆRBACç»†ç²’åº¦æ§åˆ¶ï¼‰                                â”‚
â”‚   â€¢ èŠ‚æµé™æµ                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                     â”‚                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä¸šåŠ¡æœåŠ¡   â”‚    â”‚   å®æ—¶æœåŠ¡     â”‚  â”‚    å®šæ—¶ä»»åŠ¡     â”‚
â”‚  (Django)   â”‚    â”‚  (Channels)   â”‚  â”‚   (Celery)     â”‚
â”‚             â”‚    â”‚               â”‚  â”‚                â”‚
â”‚ â€¢ é¡¹ç›®ç®¡ç†  â”‚    â”‚ â€¢ WebSocket   â”‚  â”‚ â€¢ é€¾æœŸæ£€æŸ¥     â”‚
â”‚ â€¢ ä»»åŠ¡ç®¡ç†  â”‚    â”‚   è¿æ¥ç®¡ç†    â”‚  â”‚ â€¢ æ¯æ—¥æé†’     â”‚
â”‚ â€¢ æˆå‘˜ç®¡ç†  â”‚    â”‚ â€¢ æ¶ˆæ¯æ¨é€    â”‚  â”‚ â€¢ æ•°æ®å½’æ¡£     â”‚
â”‚ â€¢ æ–‡ä»¶ç®¡ç†  â”‚    â”‚ â€¢ é¢‘é“è®¢é˜…    â”‚  â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®å±‚                                     â”‚
â”‚   MySQL 8                Redis             MinIO             â”‚
â”‚   (ä¸šåŠ¡æ•°æ®)            (ç¼“å­˜/WSçŠ¶æ€)       (å¯¹è±¡å­˜å‚¨)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 è§’è‰²æƒé™çŸ©é˜µ

| åŠŸèƒ½æ¨¡å—     | æ“ä½œ                   | è¶…çº§ç®¡ç†å‘˜ | å›¢é˜Ÿç®¡ç†å‘˜ | å›¢é˜Ÿæˆå‘˜            | è®¿å®¢ |
| ------------ | ---------------------- | ---------- | ---------- | ------------------- | ---- |
| **ç³»ç»Ÿç®¡ç†** | ç³»ç»Ÿé…ç½®/æ—¥å¿—æŸ¥çœ‹      | âœ…          | âŒ          | âŒ                   | âŒ    |
|              | ç¡¬åˆ é™¤å½’æ¡£é¡¹ç›®         | âœ…          | âŒ          | âŒ                   | âŒ    |
| **å›¢é˜Ÿç®¡ç†** | é‚€è¯·/ç§»é™¤æˆå‘˜          | âœ…          | âœ…          | âŒ                   | âŒ    |
|              | åˆ†é…è§’è‰²               | âœ…          | âœ…          | âŒ                   | âŒ    |
| **é¡¹ç›®ç®¡ç†** | åˆ›å»ºé¡¹ç›®ï¼ˆéœ€åˆ†é…æˆå‘˜ï¼‰ | âœ…          | âœ…          | âŒ                   | âŒ    |
|              | å½’æ¡£é¡¹ç›®               | âœ…          | âœ…          | âŒ                   | âŒ    |
|              | æŸ¥çœ‹æ‰€æœ‰é¡¹ç›®åˆ—è¡¨       | âœ…          | âœ…          | âœ…                   | âŒ    |
|              | æŸ¥çœ‹é¡¹ç›®è¿›åº¦/ç»Ÿè®¡      | âœ…          | âœ…          | âŒ                   | âŒ    |
| **ä»»åŠ¡ç®¡ç†** | åˆ›å»ºä¸»ä»»åŠ¡             | âœ…          | âœ…          | âŒ                   | âŒ    |
|              | åˆ†é…ä¸»ä»»åŠ¡è´Ÿè´£äºº       | âœ…          | âœ…          | âŒ                   | âŒ    |
|              | æŸ¥çœ‹æ‰€æœ‰ä¸»ä»»åŠ¡è¯¦æƒ…     | âœ…          | âœ…          | âŒï¼ˆä»…è‡ªå·±çš„ï¼‰       | âŒ    |
|              | æŸ¥çœ‹ä»–äººä»»åŠ¡æ ‡é¢˜       | âœ…          | âœ…          | âœ…ï¼ˆè„±æ•ï¼‰           | âŒ    |
|              | åˆ›å»ºå­ä»»åŠ¡ï¼ˆ3å±‚å†…ï¼‰    | âœ…          | âœ…          | âœ…ï¼ˆä»…è‡ªå·±çš„ä¸»ä»»åŠ¡ï¼‰ | âŒ    |
|              | æ›´æ–°ä»»åŠ¡çŠ¶æ€           | âœ…          | âœ…          | âœ…ï¼ˆä»…è‡ªå·±çš„ï¼‰       | âŒ    |
|              | ä¸Šä¼ é™„ä»¶               | âœ…          | âœ…          | âœ…ï¼ˆä»…è‡ªå·±çš„ï¼‰       | âŒ    |
| **å¯è§†åŒ–**   | æŸ¥çœ‹ç”˜ç‰¹å›¾ï¼ˆå…¨éƒ¨ï¼‰     | âœ…          | âœ…          | âŒ                   | âŒ    |
|              | æŸ¥çœ‹ç”˜ç‰¹å›¾ï¼ˆä¸ªäººï¼‰     | âœ…          | âœ…          | âœ…                   | âŒ    |
|              | æŸ¥çœ‹çœ‹æ¿/æ—¥å†          | âœ…          | âœ…          | âœ…ï¼ˆæ•°æ®è¿‡æ»¤ï¼‰       | âŒ    |

---

## 3. æ•°æ®æ¨¡å‹è®¾è®¡

### 3.1 ERå›¾æ ¸å¿ƒå…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    User      â”‚       â”‚    Team      â”‚       â”‚   Project    â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)      â”‚â—„â”€â”€â”€â”€â”€â”€â”¤ id (PK)      â”‚â—„â”€â”€â”€â”€â”€â”€â”¤ id (PK)      â”‚
â”‚ username     â”‚  N:1  â”‚ name         â”‚  1:N  â”‚ title        â”‚
â”‚ email        â”‚       â”‚ created_at   â”‚       â”‚ description  â”‚
â”‚ role         â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ status       â”‚
â”‚ team_id (FK) â”‚                              â”‚ is_archived  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚ start_date   â”‚
                                              â”‚ end_date     â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚ Attachment   â”‚       â”‚    Task      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚     1:N
â”‚ id (PK)      â”‚       â”‚ id (PK)      â”‚
â”‚ file_key     â”‚       â”‚ project_id   â”‚
â”‚ task_id (FK) â”‚â”€â”€â”€â”€â”€â”€â–ºâ”‚ assignee_id  â”‚
â”‚ uploaded_by  â”‚       â”‚ title        â”‚
â”‚ url          â”‚       â”‚ status       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ priority     â”‚
                       â”‚ level (1-3)  â”‚
                       â”‚ parent_id    â”‚â”€â”€â”€â”
                       â”‚ path         â”‚   â”‚ è‡ªå…³è”
                       â”‚ normal_flag  â”‚   â”‚ å±‚çº§ç»“æ„
                       â”‚ start_date   â”‚   â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                               â–²          â”‚
                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 å…³é”®è¡¨ç»“æ„

status: ENUM('planning', 'pending', 'in_progress', 'completed') DEFAULT 'planning'

**çŠ¶æ€å«ä¹‰**ï¼š

è¡¨æ ¼

å¤åˆ¶

| çŠ¶æ€å€¼        | ä¸­æ–‡å«ä¹‰   | è¯´æ˜                                     |
| :------------ | :--------- | :--------------------------------------- |
| `planning`    | **è§„åˆ’ä¸­** | å·²åˆ›å»ºä½†æœªå¼€å§‹ï¼Œå¯è°ƒæ•´æ—¶é—´/è´Ÿè´£äºº        |
| `pending`     | **å¾…å¤„ç†** | ç­‰å¾…å¼€å§‹ï¼ˆé˜Ÿåˆ—ä¸­ï¼‰ï¼Œå¯¹åº”æ‚¨çš„"æœªå®Œæˆ"æ¦‚å¿µ |
| `in_progress` | **è¿›è¡Œä¸­** | è´Ÿè´£äººå·²å¼€å§‹æ‰§è¡Œ                         |
| `completed`   | **å·²å®Œæˆ** | è´Ÿè´£äººæ ‡è®°å®Œæˆï¼Œå¯äº¤ä»˜/éªŒæ”¶              |

**çŠ¶æ€æµè½¬è§„åˆ™**ï¼š

- å…è®¸ä»»æ„çŠ¶æ€äº’è½¬ï¼ˆå¦‚ `completed` â†’ `planning` è¡¨ç¤ºé‡æ–°æ‰“å¼€ï¼‰

- å˜æ›´æ—¶è‡ªåŠ¨è®°å½• `task_history` å®¡è®¡æ—¥å¿—

  

#### **projects é¡¹ç›®è¡¨**
```sql
id: BIGINT PK
title: VARCHAR(100) NOT NULL
description: TEXT
status: ENUM('planning', 'pending', 'in_progress', 'completed') DEFAULT 'planning'
created_by: FK â†’ users.id
is_archived: BOOLEAN DEFAULT FALSE
archived_at: TIMESTAMP NULL
created_at: TIMESTAMP
updated_at: TIMESTAMP
```

#### **tasks ä»»åŠ¡è¡¨ï¼ˆä¸»ä»»åŠ¡+å­ä»»åŠ¡ç»Ÿä¸€å­˜å‚¨ï¼‰**
```sql
id: BIGINT PK
project_id: FK â†’ projects.id NOT NULL
title: VARCHAR(200) NOT NULL
description: TEXT
assignee_id: FK â†’ users.id NOT NULL  -- å­ä»»åŠ¡ç»§æ‰¿çˆ¶ä»»åŠ¡è´Ÿè´£äºº
status: ENUM('planning', 'pending', 'in_progress', 'completed') DEFAULT 'planning'
priority: ENUM('urgent', 'high', 'medium', 'low') DEFAULT 'medium'
-- å±‚çº§æ§åˆ¶
level: TINYINT CHECK (level IN (1,2,3))  -- 1=ä¸»ä»»åŠ¡, 2=å­ä»»åŠ¡, 3=å­™ä»»åŠ¡
parent_id: FK â†’ tasks.id NULL
path: VARCHAR(255)  -- è·¯å¾„æšä¸¾ '/1/12/34' ä¾¿äºæŸ¥è¯¢
-- æ—¶é—´è¿½è¸ª
start_date: DATE
end_date: DATE
created_at: TIMESTAMP
updated_at: TIMESTAMP
-- é€¾æœŸæ ‡è®°ï¼ˆå®Œæˆåä¹Ÿä¿ç•™ï¼‰
normal_flag: ENUM('normal', 'overdue') DEFAULT 'normal'
is_overdue_notified: BOOLEAN DEFAULT FALSE  -- å·²å‘é€é€¾æœŸæé†’
```

#### **task_history ä»»åŠ¡å˜æ›´å†å²è¡¨ï¼ˆå®¡è®¡ï¼‰**
```sql
id: BIGINT PK
task_id: FK â†’ tasks.id
changed_by: FK â†’ users.id
field_name: VARCHAR(50)  -- 'status', 'assignee', etc.
old_value: VARCHAR(255)
new_value: VARCHAR(255)
changed_at: TIMESTAMP
```

#### **notifications é€šçŸ¥è¡¨ï¼ˆæŒä¹…åŒ–ï¼‰**
```sql
id: BIGINT PK
recipient_id: FK â†’ users.id
type: ENUM('task_assigned', 'status_changed', 'due_reminder', 'overdue')
title: VARCHAR(200)
content: TEXT
task_id: FK â†’ tasks.id NULL
is_read: BOOLEAN DEFAULT FALSE
created_at: TIMESTAMP
```

---

## 4. æ ¸å¿ƒä¸šåŠ¡é€»è¾‘

### 4.1 ä»»åŠ¡å±‚çº§æ§åˆ¶ï¼ˆPath Enumerationï¼‰

**åˆ›å»ºé™åˆ¶ç®—æ³•**ï¼š
```python
def can_create_subtask(parent_task_id, current_user):
    parent = Task.objects.get(id=parent_task_id)
    
    # è§„åˆ™1ï¼šåªèƒ½åœ¨è‡ªå·±çš„ä¸»ä»»åŠ¡ä¸‹åˆ›å»ºå­ä»»åŠ¡
    if parent.assignee_id != current_user.id:
        return False, "åªèƒ½ä¸ºè‡ªå·±çš„ä»»åŠ¡åˆ›å»ºå­ä»»åŠ¡"
    
    # è§„åˆ™2ï¼šå±‚çº§æ·±åº¦é™åˆ¶ä¸º3
    if parent.level >= 3:
        return False, "å·²è¾¾åˆ°æœ€å¤§å±‚çº§æ·±åº¦ï¼ˆ3å±‚ï¼‰"
    
    # è§„åˆ™3ï¼šæ–°ä»»åŠ¡level = parent.level + 1
    new_level = parent.level + 1
    new_path = f"{parent.path}/{parent.id}"
    
    return True, {"level": new_level, "path": new_path}
```

### 4.2 æƒé™è„±æ•é€»è¾‘

**ä»»åŠ¡è¯¦æƒ…æŸ¥è¯¢ç­–ç•¥**ï¼š

```python
def get_task_detail(task_id, current_user):
    task = Task.objects.get(id=task_id)
    
    # ç®¡ç†å‘˜æˆ–è´Ÿè´£äººï¼šå®Œæ•´æƒé™
    if current_user.is_admin or task.assignee_id == current_user.id:
        return full_serializer(task)
    
    # å…¶ä»–æˆå‘˜ï¼šè„±æ•æ•°æ®
    return {
        "id": task.id,
        "title": task.title,  # ä»…æ ‡é¢˜å¯è§
        "status": "private",  # çŠ¶æ€éšè—
        "description": None,   # å†…å®¹è„±æ•
        "assignee": "ğŸ”’ ç§æœ‰ä»»åŠ¡",
        "can_view": False,
        "message": "è¯¥ä»»åŠ¡æœªåˆ†é…ç»™æ‚¨ï¼Œæ— æƒæŸ¥çœ‹è¯¦æƒ…"
    }
```

### 4.3 è¿›åº¦è®¡ç®—è§„åˆ™

**é¡¹ç›®å®Œæˆåº¦ç®—æ³•**ï¼š
```python
def calculate_project_progress(project_id):
    # åªç»Ÿè®¡level=1çš„ä¸»ä»»åŠ¡
    main_tasks = Task.objects.filter(project_id=project_id, level=1)
    
    total = main_tasks.count()
    if total == 0:
        return 0
    
    completed = main_tasks.filter(status='done').count()
    return round((completed / total) * 100, 2)
```

### 4.4 é€¾æœŸæ£€æµ‹ä¸æé†’

**å®šæ—¶ä»»åŠ¡ç­–ç•¥ï¼ˆCelery Beatï¼‰**ï¼š
- **æ¯æ—¥09:00**ï¼šæ‰«æ `end_date = ä»Šå¤©` ä¸” `status â‰  done` çš„ä»»åŠ¡
  - æ¨é€æé†’ï¼š"ä»Šæ—¥æˆªæ­¢ï¼š{task_title}"
  - æ ‡è®° `is_due_notified = True`
  
- **æ¯æ—¥00:01**ï¼šæ‰«æ `end_date < ä»Šå¤©` ä¸” `status â‰  done` ä¸” `normal_flag = 'normal'` çš„ä»»åŠ¡
  - æ›´æ–° `normal_flag = 'overdue'`
  - æ¨é€é€¾æœŸé€šçŸ¥ï¼ˆä»…ä¸€æ¬¡ï¼‰

**æ³¨æ„**ï¼šä»»åŠ¡æ ‡è®°ä¸ºdoneåï¼Œ`normal_flag`ä¿æŒoverdueä¸å˜ï¼Œä¿ç•™é€¾æœŸè®°å½•ã€‚

---

## 5. APIæ¥å£è®¾è®¡ï¼ˆæ ¸å¿ƒï¼‰

### 5.1 è®¤è¯æ¨¡å—
```
POST   /api/auth/login/              # JWTè·å–
POST   /api/auth/refresh/            # Tokenåˆ·æ–°
POST   /api/auth/logout/             # æ³¨é”€ï¼ˆæ‹‰é»‘Tokenï¼‰
GET    /api/auth/me/                 # å½“å‰ç”¨æˆ·ä¿¡æ¯
```

### 5.2 é¡¹ç›®ç®¡ç†
```
GET    /api/projects/                # é¡¹ç›®åˆ—è¡¨ï¼ˆæ‰€æœ‰è§’è‰²å¯è§ï¼‰
POST   /api/projects/                # åˆ›å»ºé¡¹ç›®ï¼ˆéœ€assignee_idsåˆ—è¡¨ï¼‰
GET    /api/projects/{id}/           # é¡¹ç›®è¯¦æƒ…
GET    /api/projects/{id}/progress/  # è¿›åº¦ç»Ÿè®¡ï¼ˆä»…ä¸»ä»»åŠ¡ï¼‰
PATCH  /api/projects/{id}/archive/   # å½’æ¡£é¡¹ç›®
DELETE /api/projects/{id}/           # ç¡¬åˆ é™¤ï¼ˆä»…è¶…çº§ç®¡ç†å‘˜+å·²å½’æ¡£ï¼‰
```

### 5.3 ä»»åŠ¡ç®¡ç†
```
GET    /api/projects/{id}/tasks/            # ä»»åŠ¡æ ‘ï¼ˆæ ¹æ®è§’è‰²è¿‡æ»¤ï¼‰
POST   /api/projects/{id}/tasks/            # åˆ›å»ºä¸»ä»»åŠ¡ï¼ˆlevel=1ï¼‰
POST   /api/tasks/{id}/subtasks/            # åˆ›å»ºå­ä»»åŠ¡ï¼ˆlevel+1ï¼‰
GET    /api/tasks/{id}/                     # ä»»åŠ¡è¯¦æƒ…ï¼ˆæƒé™è„±æ•ï¼‰
PATCH  /api/tasks/{id}/                     # æ›´æ–°ä»»åŠ¡ï¼ˆéƒ¨åˆ†æ›´æ–°ï¼‰
GET    /api/tasks/{id}/history/             # å˜æ›´å†å²
POST   /api/tasks/{id}/attachments/         # ä¸Šä¼ é™„ä»¶ï¼ˆé¢„ç­¾åURLï¼‰
```

**æŸ¥è¯¢å‚æ•°**ï¼š
- `?view=tree`ï¼šè¿”å›æ ‘å½¢ç»“æ„ï¼ˆä¸ªäººè§†å›¾ä½¿ç”¨ï¼‰
- `?view=flat`ï¼šè¿”å›æ‰å¹³åˆ—è¡¨ï¼ˆçœ‹æ¿è§†å›¾ä½¿ç”¨ï¼‰
- `?assignee=me`ï¼šä»…æŸ¥çœ‹è‡ªå·±çš„ä»»åŠ¡

### 5.4 å¯è§†åŒ–æ•°æ®
```
GET    /api/projects/{id}/gantt/            # ç”˜ç‰¹å›¾æ•°æ®
       # ç®¡ç†å‘˜ï¼šæ‰€æœ‰ä¸»ä»»åŠ¡
       # æˆå‘˜ï¼šä»…è‡ªå·±çš„ä¸»ä»»åŠ¡+å­ä»»åŠ¡æ ‘
       
GET    /api/projects/{id}/kanban/           # çœ‹æ¿æ•°æ®ï¼ˆæŒ‰statusåˆ†ç»„ï¼‰
GET    /api/projects/{id}/calendar/         # æ—¥å†æ•°æ®ï¼ˆæŒ‰dateåˆ†ç»„ï¼‰
```

**ç”˜ç‰¹å›¾æ•°æ®ç»“æ„**ï¼š
```json
{
  "tasks": [
    {
      "id": 1,
      "title": "éœ€æ±‚åˆ†æ",
      "start": "2026-02-01",
      "end": "2026-02-05",
      "progress": 100,
      "assignee": "å¼ ä¸‰",
      "level": 1,
      "children": [...]  // ä»…ä¸ªäººè§†å›¾è¿”å›
    }
  ],
  "dependencies": []  // æš‚ä¸ä½¿ç”¨ï¼Œé¢„ç•™å­—æ®µ
}
```

### 5.5 æˆå‘˜ç®¡ç†
```
GET    /api/team/members/             # æˆå‘˜åˆ—è¡¨
POST   /api/team/invite/              # é‚€è¯·è®¿å®¢ï¼ˆè¾“å…¥username/emailï¼‰
PATCH  /api/team/members/{id}/role/   # æ›´æ”¹è§’è‰²ï¼ˆadmin/memberï¼‰
DELETE /api/team/members/{id}/        # ç§»é™¤æˆå‘˜
```

### 5.6 å®æ—¶é€šçŸ¥ï¼ˆWebSocketï¼‰
```
WS     /ws/notifications/             # ä¸ªäººé€šçŸ¥é¢‘é“
WS     /ws/projects/{id}/             # é¡¹ç›®çº§é¢‘é“ï¼ˆä»»åŠ¡å˜æ›´å¹¿æ’­ï¼‰

# æ¶ˆæ¯æ ¼å¼
{
  "type": "task_assigned", 
  "task_id": 123,
  "title": "æ‚¨è¢«åˆ†é…äº†æ–°ä»»åŠ¡ï¼šAPIå¼€å‘",
  "timestamp": "2026-02-09T10:00:00Z"
}
```

---

## 6. é¡µé¢é€»è¾‘ä¸äº¤äº’

### 6.1 æˆå‘˜ç«¯ï¼ˆé¦–é¡µï¼‰

**ä»»åŠ¡å¡ç‰‡è§†å›¾**ï¼š
- **æ—¶é—´ç»´åº¦åˆ‡æ¢**ï¼šä»Šæ—¥ï¼ˆæˆªæ­¢ä»Šå¤©ï¼‰/ æœ¬å‘¨ï¼ˆæœ¬å‘¨æˆªæ­¢ï¼‰/ é€¾æœŸï¼ˆå·²é€¾æœŸæœªå®Œæˆï¼‰
- **ç»Ÿè®¡å±•ç¤º**ï¼šå„ç»´åº¦ä»»åŠ¡æ•°é‡ badge
- **å¿«é€Ÿæ“ä½œ**ï¼šç‚¹å‡»å¡ç‰‡è¿›å…¥ä»»åŠ¡è¯¦æƒ…ï¼Œå¯åˆ›å»ºå­ä»»åŠ¡ï¼ˆæœ€å¤š3å±‚ï¼‰

**é¡¹ç›®è§†å›¾**ï¼š
- é¡¹ç›®åˆ—è¡¨ â†’ ç‚¹å‡»è¿›å…¥ â†’ çœ‹æ¿/ç”˜ç‰¹å›¾/æ—¥å†åˆ‡æ¢
- **æ•°æ®è¿‡æ»¤**ï¼šä»…æ˜¾ç¤º `assignee = me` çš„ä¸»ä»»åŠ¡
- **ç”˜ç‰¹å›¾**ï¼šå±•ç¤ºè¯¥ä¸»ä»»åŠ¡ä¸‹çš„å­ä»»åŠ¡å±‚çº§ï¼ˆå¯æŠ˜å å±•å¼€ï¼‰

### 6.2 ç®¡ç†å‘˜ç«¯ï¼ˆé¦–é¡µï¼‰

**é¡¹ç›®ä»ªè¡¨ç›˜**ï¼š
- **é¡¹ç›®å¡ç‰‡**ï¼šè¿›åº¦æ¡ï¼ˆåŸºäºä¸»ä»»åŠ¡å®Œæˆç‡ï¼‰ã€æˆå‘˜æ•°ã€é€¾æœŸä»»åŠ¡æ•°
- **å¿«é€Ÿåˆ›å»º**ï¼šé¡¹ç›®+åˆå§‹æˆå‘˜åˆ†é…ï¼ˆè‡³å°‘1äººï¼‰

**é¡¹ç›®è¯¦æƒ…**ï¼š
- **çœ‹æ¿è§†å›¾**ï¼šæ‰€æœ‰ä¸»ä»»åŠ¡æŒ‰çŠ¶æ€åˆ—å±•ç¤ºï¼ˆå¯æ‹–æ‹½å˜æ›´çŠ¶æ€ï¼‰
- **ç”˜ç‰¹å›¾**ï¼šæ—¥è§†å›¾ï¼Œå±•ç¤ºæ‰€æœ‰æˆå‘˜çš„ä¸»ä»»åŠ¡æ—¶é—´è½´ï¼ˆä¸åŒé¢œè‰²åŒºåˆ†è´Ÿè´£äººï¼‰
- **æˆå‘˜å·¥ä½œé‡**ï¼šç»Ÿè®¡è§†å›¾ï¼ˆæ¯ä¸ªäººçš„ä»»åŠ¡æ•°é‡åˆ†å¸ƒï¼‰

### 6.3 è®¿å®¢çŠ¶æ€

**ç™»å½•åé¡µé¢**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ğŸ”’ ç­‰å¾…å›¢é˜Ÿé‚€è¯·         â”‚
â”‚                              â”‚
â”‚  æ‚¨å·²æ³¨å†ŒæˆåŠŸï¼Œè¯·è”ç³»å›¢é˜Ÿ     â”‚
â”‚  ç®¡ç†å‘˜å°†æ‚¨åŠ å…¥å›¢é˜Ÿä»¥å¼€å§‹åä½œ â”‚
â”‚                              â”‚
â”‚  [é‡æ–°æ£€æŸ¥é‚€è¯·çŠ¶æ€]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. éåŠŸèƒ½éœ€æ±‚

### 7.1 æ€§èƒ½æŒ‡æ ‡
- **APIå“åº”**ï¼š95%è¯·æ±‚ < 200msï¼ˆP95ï¼‰
- **WebSocketå»¶è¿Ÿ**ï¼šæ¶ˆæ¯æŠ•é€’ < 100ms
- **æ–‡ä»¶ä¸Šä¼ **ï¼šæ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼Œæœ€å¤§å•æ–‡ä»¶500MB

### 7.2 å®‰å…¨ç­–ç•¥
- **JWT**ï¼šAccess Token 15åˆ†é’Ÿï¼ŒRefresh Token 7å¤©
- **æ–‡ä»¶ä¸Šä¼ **ï¼šMinIOé¢„ç­¾åURLï¼Œæœ‰æ•ˆæœŸ5åˆ†é’Ÿï¼Œé™åˆ¶æ–‡ä»¶ç±»å‹ï¼ˆjpg,png,pdf,zipç­‰ï¼‰
- **SQLæ³¨å…¥**ï¼šDjango ORMé˜²æŠ¤ï¼Œç¦æ­¢åŸç”ŸSQLæ‹¼æ¥
- **XSSé˜²æŠ¤**ï¼šDRFåºåˆ—åŒ–å™¨è‡ªåŠ¨è½¬ä¹‰

### 7.3 éƒ¨ç½²æ¶æ„
- **è´Ÿè½½å‡è¡¡**ï¼šNginxåå‘ä»£ç†
- **ASGIæœåŠ¡**ï¼šDaphne/Uvicornï¼ˆWebSocketæ”¯æŒï¼‰
- **é™æ€æ–‡ä»¶**ï¼šMinIO + CDNåŠ é€Ÿ
- **æ•°æ®åº“**ï¼šMySQL 8ä¸»ä»å¤åˆ¶ï¼ˆä¸€ä¸»ä¸€ä»ï¼‰

---

## 8. åç»­è¿­ä»£å»ºè®®ï¼ˆv1.1+ï¼‰

1. **ä»»åŠ¡ä¾èµ–**ï¼šç”˜ç‰¹å›¾æ”¯æŒä¾èµ–å…³ç³»ä¸å…³é”®è·¯å¾„è®¡ç®—
2. **å·¥æ—¶ç»Ÿè®¡**ï¼šå­ä»»åŠ¡è®°å½•å®é™…å·¥æ—¶ï¼Œç”Ÿæˆä¸ªäººå‘¨æŠ¥
3. **æ¨¡æ¿åŠŸèƒ½**ï¼šé¡¹ç›®æ¨¡æ¿ã€ä»»åŠ¡æ¨¡æ¿å¿«é€Ÿåˆ›å»º
4. **ç¬¬ä¸‰æ–¹é›†æˆ**ï¼šGitLab/GitHub Webhookå…³è”ä»£ç æäº¤
5. **ç§»åŠ¨ç«¯ä¼˜åŒ–**ï¼šç¦»çº¿æ¨¡å¼æ”¯æŒï¼Œå¼±ç½‘ç¯å¢ƒæœ¬åœ°é˜Ÿåˆ—åŒæ­¥

---

**PRDæ–‡æ¡£ç”Ÿæˆå®Œæ¯•ã€‚å¦‚éœ€è°ƒæ•´ç»†èŠ‚ï¼ˆå¦‚å­—æ®µå‘½åã€çŠ¶æ€æšä¸¾å€¼ï¼‰æˆ–è¡¥å……ç‰¹å®šæ¨¡å—ï¼ˆå¦‚MinIOé›†æˆç»†èŠ‚ã€FlutterçŠ¶æ€ç®¡ç†æ–¹æ¡ˆï¼‰ï¼Œè¯·å‘ŠçŸ¥ï¼**